/*! For license information please see chunk-server-6d315e4cef1f4500.js.LICENSE.txt */
/*!
 * PSPDFKit for Web 2020.5.1 (https://pspdfkit.com/web)
 * 
 * Copyright (c) 2016-2019 PSPDFKit GmbH. All rights reserved.
 * 
 * THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
 * AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
 * UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
 * This notice may not be removed from this file.
 * 
 * PSPDFKit uses several open source third-party components: https://pspdfkit.com/acknowledgements/web/
 */
(window.__PSPDFKitChunk=window.__PSPDFKitChunk||[]).push([[59],{848:function(module,exports,__webpack_require__){(function(global){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(t,e){module.exports=e(t)}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==global?global:this,(function(global){"use strict";global=global||{};var _Base64=global.Base64,version="2.5.2",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(t){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(t){for(var e={},n=0,r=t.length;n<r;n++)e[t.charAt(n)]=n;return e}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?fromCharCode(192|e>>>6)+fromCharCode(128|63&e):fromCharCode(224|e>>>12&15)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return fromCharCode(240|e>>>18&7)+fromCharCode(128|e>>>12&63)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(t){return t.replace(re_utob,cb_utob)},cb_encode=function(t){var e=[0,2,1][t.length%3],n=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[b64chars.charAt(n>>>18),b64chars.charAt(n>>>12&63),e>=2?"=":b64chars.charAt(n>>>6&63),e>=1?"=":b64chars.charAt(63&n)].join("")},btoa=global.btoa?function(t){return global.btoa(t)}:function(t){return t.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=function(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)?t.toString("base64"):btoa(utob(String(t)))},encode=function(t,e){return e?_encode(String(t)).replace(/[+\/]/g,(function(t){return"+"==t?"-":"_"})).replace(/=/g,""):_encode(t)},encodeURI=function(t){return encode(t,!0)},re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return fromCharCode(55296+(e>>>10))+fromCharCode(56320+(1023&e));case 3:return fromCharCode((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return fromCharCode((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},btou=function(t){return t.replace(re_btou,cb_btou)},cb_decode=function(t){var e=t.length,n=e%4,r=(e>0?b64tab[t.charAt(0)]<<18:0)|(e>1?b64tab[t.charAt(1)]<<12:0)|(e>2?b64tab[t.charAt(2)]<<6:0)|(e>3?b64tab[t.charAt(3)]:0),a=[fromCharCode(r>>>16),fromCharCode(r>>>8&255),fromCharCode(255&r)];return a.length-=[0,0,2,1][n],a.join("")},_atob=global.atob?function(t){return global.atob(t)}:function(t){return t.replace(/\S{1,4}/g,cb_decode)},atob=function(t){return _atob(String(t).replace(/[^A-Za-z0-9\+\/]/g,""))},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t,"base64")).toString()}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t,"base64")).toString()}:function(t){return btou(_atob(t))},decode=function(t){return _decode(String(t).replace(/[-_]/g,(function(t){return"-"==t?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var t=global.Base64;return global.Base64=_Base64,t};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"==typeof Object.defineProperty){var noEnum=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum((function(){return decode(this)}))),Object.defineProperty(String.prototype,"toBase64",noEnum((function(t){return encode(this,t)}))),Object.defineProperty(String.prototype,"toBase64URI",noEnum((function(){return encode(this,!0)})))}}return global.Meteor&&(Base64=global.Base64),module.exports?module.exports.Base64=global.Base64:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return global.Base64}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)),{Base64:global.Base64}}))}).call(this,__webpack_require__(267))},911:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return nt}));var r=n(59),a=n.n(r),o=n(8),i=n.n(o),s=n(17),c=n.n(s),u=n(31),d=n.n(u),l=n(7),h=n.n(l),f=n(12),p=n.n(f),m=n(1),b=n.n(m),v=n(2);function g(t,e,n){return _.apply(this,arguments)}function _(){return(_=c()(i.a.mark((function t(e,n,r){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(e,"/auth"),{method:"POST",headers:{"Content-Type":"application/json","PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(3,", client=").concat("2020.5.1",", client-git=").concat("3a938b895d")},body:JSON.stringify({jwt:n.jwt,origin:window.location.href,password:r}),credentials:"include"});case 2:if(!(a=t.sent).ok){t.next=7;break}return t.abrupt("return",a.json());case 7:return t.abrupt("return",a.text().then((function(t){throw"INVALID_PASSWORD"===t?new v.a(t):new v.a("An error occurred while connecting to PSPDFKit Server: ".concat(t||a.statusText))})));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}n(505);var w=n(3),y=n(319),k=n(153),P=n(23),S=n(181),x=n(6),C=n(14),O=n(439),j=n(121),R=n(30),A=n(145),F=n(848);function D(t){var e="The supplied JWT is invalid. Please refer to our guides on how to set up authentication:\n  https://pspdfkit.com/guides/web/current/server-backed/client-authentication/";if(-1===t.indexOf('{"internal":')){var n;Object(v.i)("string"==typeof t&&3===t.split(".").length,e);try{var r=F.Base64.decode(t.split(".")[1]);n=JSON.parse(r)}catch(t){throw new v.a(e)}Object(v.i)("string"==typeof n.document_id,"The supplied JWT is invalid. The field 'document_id' has to be a string value.\n  Please refer to our guides for further information: https://pspdfkit.com/guides/web/current/server-backed/client-authentication/")}}var E=n(231),U=n(440),I=n(444),T=n(9),L=n.n(T),B=n(10),N=n.n(B),q=n(4),K=n.n(q);n(243);function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=K()(t);if(e){var a=K()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return N()(this,n)}}var H=function(t){L()(n,t);var e=J(n);function n(){return h()(this,n),e.apply(this,arguments)}return n}(Object(x.e)({authPayload:null,serverUrl:null,documentId:null,backendPermissions:null,documentURL:null,imageToken:null,instantSettings:null,token:null,features:Object(x.a)(),isFormsEnabled:!0,minSearchQueryLength:1,documentHandle:null,isDocumentHandleOutdated:!1,digitalSignatures:null})),W=n(75),M=(n(386),n(441)),Q=n(195),V="The image can not be rendered because of an unknown error.",z=function(){function t(e,n,r,a){h()(this,t),this.identifier=e,this.url=n,this.token=r,this.payload=a}return p()(t,[{key:"abort",value:function(){this.httpRequest&&this.httpRequest.abort()}},{key:"request",value:function(){var t=this;return new Promise((function(e,n){var r=new XMLHttpRequest;t.httpRequest=r,r.open(t.payload?"POST":"GET",t.url,!0),r.setRequestHeader("X-PSPDFKit-Image-Token",t.token),Q.b&&r.setRequestHeader("Accept","image/webp,*/*"),r.responseType="blob",r.onreadystatechange=function(){if(4===r.readyState){if(r.response&&r.response.type.startsWith("application/json")){var t=new FileReader;return t.onload=function(t){var r=JSON.parse(t.target.result);r.attachments_not_found?e({attachmentsNotFound:r.attachments_not_found}):r.error?n(new v.a("The server could not render the requested image (".concat(r.error,")"))):n(new v.a(V))},t.onerror=function(){return n(new v.a(V))},void t.readAsText(r.response)}if(Object(M.a)(r.status)){var a=r.response,o=URL.createObjectURL(a),i=new Image;i.onload=function(){var t=new E.a(i,(function(){return URL.revokeObjectURL(o)}));e(t)},i.onerror=function(){return n(new v.a(V))},i.src=o}else n(new v.a(V))}}.bind(t),r.send(t.payload)}))}}]),t}(),X=n(100),Y=n(323),G=n(445),Z=n(371),$=n(155);function tt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(n),!0).forEach((function(e){b()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var nt=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;h()(this,t),b()(this,"_password",null),b()(this,"type","SERVER"),b()(this,"_requestRenderAnnotation",(function(t,e,r,a,o,i){var s,c,u="".concat(n._state.documentURL,"/render_annotation"),d="render-annotation-".concat(i?Object(X.a)():t.id),l=JSON.stringify({data:Object(R.o)(t),width:a,height:o,detached:i||void 0,formFieldValue:e?Object(R.s)(e):void 0}),h=!1,f=[],p=new Promise((function(t,e){s=t,c=e}));return function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=new FormData;o.append("render",l),a.length>0&&t.imageAttachmentId&&r&&r.data&&o.append(t.imageAttachmentId,r.data);var i=new z(d,u,n._state.imageToken,o),p=n._requestQueue.enqueue(i,!1);p.promise.then((function(t){h||(t.attachmentsNotFound?e(t.attachmentsNotFound):t.attachmentsNotFound?c(new v.a("Attachment could not be found.")):s(t))})).catch((function(t){h||c(t)})),f.push(p)}(),{promise:p,cancel:function(){h=!0,f.forEach((function(t){return t.cancel()}))}}})),b()(this,"handleDocumentHandleConflict",(function(){n._state=n._state.set("isDocumentHandleOutdated",!0),n.cancelRequests(),n._destroyProvider()}));var a=e.serverUrl||Object(k.a)(r.document);if("/"!==a.substr(-1))throw new v.a("`serverUrl` must have a slash at the end (e.g. `https://pspdfkit.example.com/`).");if(!e.serverUrl){var o="".concat(r.location.protocol,"//").concat(r.location.host,"/");if(a===o)throw new v.a('PSPDFKit automatically infers the URL of PSPDFKit Server from the current `<script>` tag.\nIn the current case, this URL is set to the same as the current browser\'s location.\nThis can happen when you bundle pspdfkit.js with your custom JavaScript for example.\n\nTo make sure everything works as expected, please set the `serverUrl` to the URL of PSPDFKit Server:\n\nPSPDFKit.load({\n  serverUrl: "https://pspdfkit-server.example.com/",\n  ...,\n});')}if("string"!=typeof e.documentId)throw new v.a("`documentId` must be of type string.");if("object"!==d()(e.authPayload)||"string"!=typeof e.authPayload.jwt)throw new v.a("authPayload must be an object that contains the `jwt`. For example: `authPayload: { jwt: 'xxx.xxx.xxx'}`");D(e.authPayload.jwt),it(e.instant);var i=null;if(e.instant)if(Object(v.j)(e.instant)){var s=e.instant;i={clientsPresenceEnabled:!1!==s.clientsPresenceEnabled,listenToServerChangesEnabled:!1!==s.listenToServerChangesEnabled}}else i=G.a;this._requestQueue=new I.a(C.C),this._state=new H({serverUrl:a,documentId:e.documentId,instantSettings:i,documentURL:"".concat(a,"i/d/").concat(e.documentId),authPayload:e.authPayload,isFormsEnabled:!e.disableForms}),e.trustedCAsCallback&&Object(v.n)("PSPDFKit.Configuration#trustedCAsCallback is only used on Standalone deployments. On a Server-backed deployment, please follow the instructions at https://pspdfkit.com/guides/web")}var e,r,o,s,u,l,f,m,_,F,E,T,L,B,N,q;return p()(t,[{key:"isUsingInstantProvider",value:function(){return null!=this._state.instantSettings}},{key:"hasClientsPresence",value:function(){var t=this._state.instantSettings;return null!=t&&!1!==t.clientsPresenceEnabled}},{key:"load",value:(q=c()(i.a.mark((function t(e){var n,r,a,o,s,c,u,d,l,h,f=this;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g("".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId),this._state.authPayload,e);case 2:if(n=t.sent,r=n.imageToken,a=n.token,o=n.permissions,s=n.features,c=n.hasPassword,u=n.minSearchQueryLength,d=n.layerHandle,l=n.allowedTileScales,h=n.digitalSignatures,this._password=e,!this._state.instantSettings||s.includes(w.z.INSTANT)){t.next=15;break}throw new v.a("Instant feature is not enabled on this server. Please set `instant` to `false`.\n\nFor more information about PSPDFKit Instant please visit:\nhttps://pspdfkit.com/guides/web/current/instant/overview/");case 15:return this._state=this._state.withMutations((function(t){return t.set("imageToken",r).set("token",a).set("features",Object(x.a)(s)).set("backendPermissions",new w.c({readOnly:-1===o.indexOf("write"),downloadingAllowed:o.indexOf("download")>=0})).set("documentURL","".concat(f._state.serverUrl,"i/d/").concat(f._state.documentId,"/h/").concat(d)).set("documentHandle",d).set("isDocumentHandleOutdated",!1).set("digitalSignatures",Object(R.g)(h))})),this.provider&&this.provider.destroy(),t.next=19,this._initProvider();case 19:return this.provider=t.sent,this._state.instantSettings&&this.provider.setDocumentHandleConflictCallback(this.handleDocumentHandleConflict),t.abrupt("return",{features:this._state.features,hasPassword:c,minSearchQueryLength:u,allowedTileScales:l,jsActionChanges:[]});case 22:case"end":return t.stop()}}),t,this)}))),function(t){return q.apply(this,arguments)})},{key:"_initProvider",value:(N=c()(i.a.mark((function t(){var e,r,a,o,s,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._state.instantSettings){t.next=9;break}return e="".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId,"/h/").concat(this._state.documentHandle),t.next=4,Promise.resolve().then(n.bind(null,839));case 4:return r=t.sent,a=r.InstantProvider,t.abrupt("return",new a("".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId),e,{auth_token:this._state.token},this._state.instantSettings));case 9:return o=this._state.isFormsEnabled&&this._state.features.includes(w.z.FORMS),t.next=12,Promise.resolve().then(n.bind(null,503));case 12:return s=t.sent,c=s.RESTProvider,t.abrupt("return",new c(this._state.documentURL,{token:this._state.token},{isFormsEnabled:o}));case 15:case"end":return t.stop()}}),t,this)}))),function(){return N.apply(this,arguments)})},{key:"destroy",value:function(){this._destroyProvider(),this._requestQueue&&this._requestQueue.destroy()}},{key:"documentInfo",value:function(){return this._fetch("".concat(this._state.documentURL,"/document.json")).then((function(t){return t.json()})).then((function(t){return t.data.totalPages=t.data.pageCount,t.data}))}},{key:"getFormJSON",value:function(){return this._fetch("".concat(this._state.documentURL,"/form.json")).then((function(t){return 403===t.status?{v:1,type:"pspdfkit/form",annotations:[],fields:[]}:t.json().then((function(t){return t.data}))}))}},{key:"evalFormValuesActions",value:(B=c()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("not implemented");case 1:case"end":return t.stop()}}),t)}))),function(){return B.apply(this,arguments)})},{key:"evalScript",value:(L=c()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("not implemented");case 1:case"end":return t.stop()}}),t)}))),function(){return L.apply(this,arguments)})},{key:"permissions",value:function(){return Promise.resolve(this._state.backendPermissions)}},{key:"textForPageIndex",value:function(t){var e="".concat(this._state.documentURL,"/page-").concat(t,"-text"),n=new(this._getJSONRequestHandler())(e,this._state.token),r=this._requestQueue.enqueue(n,!0);return{promise:r.promise.then((function(e){return Object(S.b)(e,t)})),cancel:function(){r.cancel()}}}},{key:"getTextFromRects",value:function(t,e){var n=encodeURIComponent(JSON.stringify(e.map(j.b).toArray()));return this._fetch("".concat(this._state.documentURL,"/page-").concat(t,"-highlighted?rects=").concat(n)).then((function(t){return t.json()})).then((function(t){return t.text}))}},{key:"_getJSONRequestHandler",value:function(){return U.a}},{key:"renderTile",value:function(t,e,n,r,a){var o=this;if(this._state.isDocumentHandleOutdated)return{promise:new Promise((function(){})),cancel:function(){}};var i,s,c="".concat(this._state.documentURL,"/page-").concat(t,"-dimensions-").concat(e.width,"-").concat(e.height,"-tile-").concat(n.left,"-").concat(n.top,"-").concat(n.width,"-").concat(n.height).concat(r?"-print":""),u=e.width===n.width&&e.height===n.height,d=!1,l=!1,h=[],f=[],p=new Promise((function(t,e){i=t,s=e}));return function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(a){var r=new FormData;r.append("data",JSON.stringify({annotations:a.annotations.filter(P.r).map(R.o).toJS().map((function(t){return{content:t}})),formFieldValues:a.formFieldValues.map(R.s).toJS(),formFields:a.formFields.map(R.r).toJS(),signatures:a.signatures||[]})),n.length>0&&n.forEach((function(t){var e=a.attachments.get(t);Object(v.i)(e&&e.data,"Attachment data could not be found."),r.append(t,e.data)})),e=new z(c,c,o._state.imageToken,r)}else e=new z(c,c,o._state.imageToken);f.push(e);var p=o._requestQueue.enqueue(e,u);p.promise.then((function(e){if(!d)return e.attachmentsNotFound&&!l?(l=!0,void t(e.attachmentsNotFound)):void(e.attachmentsNotFound?s(new v.a("Attachment could not be found.")):i(e))})).catch((function(t){d||s(t)})),h.push(p)}(),{promise:p,cancel:function(){d=!0,f.forEach((function(t){t.abort&&"function"==typeof t.abort&&t.abort()})),h.forEach((function(t){return t.cancel()}))}}}},{key:"renderAnnotation",value:function(t,e,n,r,a){return this._requestRenderAnnotation(t,e,n,r,a)}},{key:"renderPageAPStreams",value:(T=c()(i.a.mark((function t(e,n,r,a,o){var s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.renderTile(e,r.toObject(),new w.K({width:r.width,height:r.height}).toObject(),!1,{annotations:a,formFieldValues:o.map((function(t){return new A.a({name:t.name,value:t.value})})),attachments:Object(x.b)(),formFields:o});case 2:return s=t.sent,t.t0=W.j,t.next=6,s.promise;case 6:return t.t1=t.sent,t.t2=r.width,t.t3=r.height,t.t4=a,t.t5=n,t.t6={imageHandle:t.t1,width:t.t2,height:t.t3,annotations:t.t4,scaleFactor:t.t5},t.abrupt("return",(0,t.t0)(t.t6));case 13:case"end":return t.stop()}}),t,this)}))),function(t,e,n,r,a){return T.apply(this,arguments)})},{key:"renderDetachedAnnotation",value:function(t,e,n,r){return this._requestRenderAnnotation(t,null,e,n,r,!0)}},{key:"getAttachment",value:(E=c()(i.a.mark((function t(e){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._fetch("".concat(this._state.documentURL,"/attachments/").concat(e));case 3:n=t.sent,t.t0=n.status,t.next=404===t.t0?7:200===t.t0?8:11;break;case 7:throw new v.a("Attachment not Found.");case 8:return t.next=10,n.blob();case 10:return t.abrupt("return",t.sent);case 11:throw new v.a("Bad Request.");case 12:t.next=17;break;case 14:throw t.prev=14,t.t1=t.catch(0),new v.a("Could not fetch attachment from PSPDFKit Server. ".concat(t.t1));case 17:case"end":return t.stop()}}),t,this,[[0,14]])}))),function(t){return E.apply(this,arguments)})},{key:"search",value:(F=c()(i.a.mark((function t(e,n,r){var a,o,s,c,u,d=arguments;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=d.length>3&&void 0!==d[3]&&d[3],o=d.length>4&&void 0!==d[4]?d[4]:$.a.TEXT,s="q=".concat(o===$.a.PRESET?e.replace(/_/g,"-"):encodeURIComponent(e),"&start=").concat(n,"&limit=").concat(r,"&type=").concat(o,"&include_annotations=").concat(a.toString()),c="".concat(this._state.documentURL,"/search?").concat(s),t.next=6,new U.a(c,this._state.token).request();case 6:return u=t.sent,t.abrupt("return",Object(O.a)(u.data));case 8:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return F.apply(this,arguments)})},{key:"searchAndRedact",value:(_=c()(i.a.mark((function t(e,n){var r,o,s,c,u,d,l,h,f,p,m;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.searchType,s=n.annotationPreset,c=n.searchInAnnotations,u=s.color,d=s.fillColor,l=s.outlineColor,h=a()(s,["color","fillColor","outlineColor"]),t.next=4,this._fetch("".concat(this._state.documentURL,"/redactions"),{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({strategy:o,strategyOptions:(r={},b()(r,o,o===$.a.PRESET?e.replace(/_/g,"-"):e),b()(r,"includeAnnotations",c),r),content:et(et({},h),{},{color:u&&u.toHex(),fillColor:d&&d.toHex(),outlineColor:l&&l.toHex()})})});case 4:return f=t.sent,t.next=7,f.json();case 7:return p=t.sent,m=p.data,t.abrupt("return",Object(x.a)(m&&m.annotations?m.annotations.map((function(t){return Z.a.fromJSON(t.id,t.content)})):[]));case 10:case"end":return t.stop()}}),t,this)}))),function(t,e){return _.apply(this,arguments)})},{key:"exportPDF",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.flatten,n=void 0!==e&&e,r=t.includeComments,a=void 0===r||r,o="".concat(this._state.documentURL,"/pdf?token=").concat(this._state.token,"&flatten=").concat(String(n),"&comments=").concat(String(a),"&render_ap_streams=").concat(String(!n));return fetch(o,{method:"GET",credentials:"include"}).then((function(t){return t.arrayBuffer()}))}},{key:"exportXFDF",value:function(){return this._fetch("".concat(this._state.documentURL,"/document.xfdf")).then((function(t){return t.text()}))}},{key:"exportInstantJSON",value:function(){return this._fetch("".concat(this._state.documentURL,"/instant.json")).then((function(t){return t.json()}))}},{key:"getPDFURL",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.includeComments,n=void 0===e||e;return{promise:Promise.resolve("".concat(this._state.documentURL,"/pdf?token=").concat(this._state.token,"&flatten=true&comments=").concat(String(n))),revoke:function(){}}}},{key:"generatePDFObjectURL",value:function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.includeComments,a=void 0===r||r,o=!1,i=new Promise((function(n){e.exportPDF({flatten:!0,includeComments:a}).then((function(e){if(!o){var r=new Blob([e],{type:"application/pdf"});t=window.URL.createObjectURL(r),n(t)}}))}));return{promise:i,revoke:function(){t&&window.URL.revokeObjectURL(t),o=!0}}}},{key:"getDocumentOutline",value:(m=c()(i.a.mark((function t(){var e,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._fetch("".concat(this._state.documentURL,"/outline.json")).then((function(t){return t.json()}));case 3:n=t.sent,e=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e={};case 10:return r=Array.isArray(e.outline)?e.outline:[],t.abrupt("return",Object(x.a)(r.map(y.a)));case 12:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return m.apply(this,arguments)})},{key:"onKeystrokeEvent",value:function(){throw new Error("not implemented")}},{key:"applyOperationsAndReload",value:(f=c()(i.a.mark((function t(e){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,at(e);case 3:return n=t.sent,this._destroyProvider(),t.next=7,this._fetch("".concat(this._state.documentURL,"/apply-operations"),{method:"post",body:n,credentials:"include"});case 7:t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(0),new v.a("Applying operations failed: ".concat(t.t0));case 12:return t.abrupt("return",this.reloadDocument());case 13:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(t){return f.apply(this,arguments)})},{key:"applyRedactionsAndReload",value:(l=c()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._destroyProvider(),t.next=4,this._fetch("".concat(this._state.documentURL,"/redact"),{method:"post",credentials:"include"});case 4:return t.abrupt("return",this.reloadDocument());case 7:throw t.prev=7,t.t0=t.catch(0),this.provider.load(),new v.a("Applying redactions failed: ".concat(t.t0));case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return l.apply(this,arguments)})},{key:"reloadDocument",value:(u=c()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.load(this._password);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),new v.a("Reloading the document failed: ".concat(t.t0));case 9:case"end":return t.stop()}}),t,this,[[0,6]])}))),function(){return u.apply(this,arguments)})},{key:"exportPDFWithOperations",value:(s=c()(i.a.mark((function t(e){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,at(e);case 3:return n=t.sent,t.abrupt("return",this._fetch("".concat(this._state.documentURL,"/pdf-with-operations"),{method:"post",body:n,credentials:"include"}).then((function(t){return t.arrayBuffer()})));case 7:throw t.prev=7,t.t0=t.catch(0),new v.a("Exporting PDF with operations failed: ".concat(t.t0));case 10:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return s.apply(this,arguments)})},{key:"getSignaturesInfo",value:(o=c()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._refreshSignaturesInfoPromise){t.next=3;break}return t.next=3,this._refreshSignaturesInfoPromise;case 3:return t.abrupt("return",this._state.digitalSignatures);case 4:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"refreshSignaturesInfo",value:function(){var t=this;return this._refreshSignaturesInfoPromise||(this._refreshSignaturesInfoPromise=new Promise((function(e,n){t._fetch("".concat(t._state.documentURL,"/signatures"),{method:"get",credentials:"include"}).then((function(t){return t.json()})).then((function(n){var r=n.data;t._state=t._state.set("digitalSignatures",Object(R.g)(r)),t._refreshSignaturesInfoPromise=null,e()})).catch((function(e){t._state=t._state.set("digitalSignatures",null),t._refreshSignaturesInfoPromise=null,n(e)}))}))),this._refreshSignaturesInfoPromise}},{key:"signDocumentAndReload",value:(r=c()(i.a.mark((function t(e,n){var r,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,void 0===n||"object"===d()(n)){t.next=3;break}throw new v.a("Signing service data must be an object if specified.");case 3:return r={},e&&"placeholderSize"in e&&(r.signerDataSource={estimatedSignatureSize:e.placeholderSize}),e&&"flatten"in e&&(r.flatten=e.flatten),a=et(et({},n?{signingToken:n.signingToken}:null),r),this._destroyProvider(),t.next=10,this._fetch("".concat(this._state.documentURL,"/sign"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});case 10:return t.next=12,this.reloadDocument();case 12:t.next=18;break;case 14:throw t.prev=14,t.t0=t.catch(0),this.provider.load(),new v.a("Adding digital signature failed: ".concat(t.t0.message||t.t0));case 18:case"end":return t.stop()}}),t,this,[[0,14]])}))),function(t,e){return r.apply(this,arguments)})},{key:"getDocumentHandle",value:function(){return this._state.documentHandle}},{key:"cancelRequests",value:function(){this._requestQueue.cancelAll()}},{key:"_destroyProvider",value:function(){this.provider&&(this.provider._clients&&this.provider._clients.disconnect(),this.provider.destroy())}},{key:"_fetch",value:(e=c()(i.a.mark((function t(e,n){var r,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,et(et({},n),{},{headers:et(et({},n&&n.headers),{},{"X-PSPDFKit-Token":this._state.token,"PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(3,", client=").concat("2020.5.1",", client-git=").concat("3a938b895d")})}));case 2:if((r=t.sent).ok){t.next=10;break}return t.next=6,rt(r);case 6:throw a=t.sent,a="object"===d()(a)?a.reason:a,o=a||"".concat(r.status," ").concat(r.statusText),new v.a(o);case 10:return t.abrupt("return",r);case 11:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"syncChanges",value:function(){return this.provider.syncChanges()}}]),t}();function rt(t){return t.clone().json().catch((function(){return t.text()}))}function at(t){return ot.apply(this,arguments)}function ot(){return(ot=c()(i.a.mark((function t(e){var n,r,a,o,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},r=new WeakMap,t.next=4,Promise.all(e.map(function(){var t=c()(i.a.mark((function t(e,a){var o,s,c,u,l,h;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("importDocument"!==e.type){t.next=6;break}return o=e.document,Object(v.i)(o instanceof File||o instanceof Blob,"Wrong `importDocument` operation `document` value: it must be a File or a Blob"),t.abrupt("return",Object(Y.a)(r,n,o,e,a,"document"));case 6:if("applyInstantJson"!==e.type){t.next=14;break}return s=e.instantJson,Object(v.i)("object"===d()(s)&&null!==s,"Wrong `applyInstantJson` operation `instantJson` value: it must be an object"),c=JSON.stringify(s),u=new Blob([c],{type:"application/json"}),t.abrupt("return",Object(Y.a)(r,n,u,e,a,"dataFilePath"));case 14:if("applyXfdf"!==e.type){t.next=19;break}return l=e.xfdf,Object(v.i)("string"==typeof l,"Wrong `applyXfdf` operation `xfdf` value: it must be a string"),h=new Blob([l],{type:"application/vnd.adobe.xfdf"}),t.abrupt("return",Object(Y.a)(r,n,h,e,a,"dataFilePath"));case 19:return t.abrupt("return",e);case 20:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 4:for(s in a=t.sent,(o=new FormData).append("operations",JSON.stringify({operations:a})),n)o.append(s,n[s]);return t.abrupt("return",o);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function it(t){var e="";if("boolean"!=typeof t&&(Object(v.j)(t)?(t.hasOwnProperty("clientsPresenceEnabled")&&"boolean"!=typeof t.clientsPresenceEnabled&&(e+="`clientsPresenceEnabled` in instance settings is not valid. Must be `true` or `false`.\n"),t.hasOwnProperty("listenToServerChangesEnabled")&&"boolean"!=typeof t.listenToServerChangesEnabled&&(e+="`listenToServerChangesEnabled` in instance settings is not valid. Must be `true` or `false`.\n")):e="`instant` flag must either be set to `true` or `false`\n",e))throw new v.a("".concat(e,"\nFor more information about PSPDFKit Instant please visit:\nhttps://pspdfkit.com/guides/web/current/instant/overview/"))}}}]);